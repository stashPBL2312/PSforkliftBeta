<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Forklifts</title>
  <script src="/common.js" defer></script>
  <!-- Export libraries (lazy-loaded on demand) -->
  <script>
    (function(){
      function loadScript(src){
        return new Promise((resolve, reject)=>{
          const s=document.createElement('script'); s.src=src; s.async=true;
          s.onload=()=>resolve(); s.onerror=()=>reject(new Error('Failed to load '+src));
          document.head.appendChild(s);
        });
      }
      window.ensureExcelJS = async function(){
        if (!window.ExcelJS){
          await loadScript('https://cdn.jsdelivr.net/npm/exceljs@4.3.0/dist/exceljs.min.js');
        }
        return window.ExcelJS;
      };
      window.ensureJsPDF = async function(){
        if (!(window.jspdf && window.jspdf.jsPDF)){
          await loadScript('https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js');
        }
        if (!window.__autoTableLoaded){
          await loadScript('https://cdn.jsdelivr.net/npm/jspdf-autotable@3.8.2/dist/jspdf.plugin.autotable.min.js');
          window.__autoTableLoaded = true;
        }
        return window.jspdf && window.jspdf.jsPDF;
      };
    })();
   </script>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin:0; }
    .wrap { max-width:1100px; margin:20px auto; padding:0 16px; }
    table { width:100%; border-collapse:collapse; }
    th, td { text-align:left; padding:8px; border-bottom:1px solid #eee; }
    th { background:#fafafa; }
    input, select, button { padding:6px 8px; }
    .toolbar { display:flex; gap:8px; align-items:center; margin-bottom:8px; }
    /* Dark mode: modal */
    [data-theme="dark"] #modal > div { background:#0f172a !important; color:#e5e7eb; box-shadow:0 10px 30px rgba(0,0,0,.6); }
    [data-theme="dark"] #modal h3 { color:#e5e7eb; }
    [data-theme="dark"] #modal div[style*='color:#666'],
    [data-theme="dark"] #modal div[style*='color:#777'] { color:#e5e7eb !important; }
    [data-theme="dark"] #modal input,
    [data-theme="dark"] #modal select,
    [data-theme="dark"] #modal textarea { background:#0b1220; border-color:#334155; color:#e5e7eb; }
    [data-theme="dark"] input::placeholder, [data-theme="dark"] textarea::placeholder { color:#e5e7eb !important; opacity:1 !important; }
  </style>
</head>
<body>
  <div id="header"></div>
  <div class="wrap">
    <h2>Forklifts</h2>
    <div class="toolbar">
      <input id="search" placeholder="Cari..." />
      <select id="rowsPerPage"><option>10</option><option>15</option><option>25</option></select>
      <button id="addBtn">Tambah</button>
      <button id="bulkDeleteBtn">Hapus Terpilih</button>
      <button id="importExcel">Import Excel</button>
      <button id="exportExcel">Export Excel</button>
      <button id="exportPDF">Export PDF</button>
    </div>
    <div id="table"></div>
    <div id="pagination" style="margin-top:8px;"></div>
  </div>

  <div id="modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,.3); align-items:center; justify-content:center;">
    <div style="background:#fff; padding:16px; border-radius:8px; width:520px; max-width:95vw; max-height:90vh; overflow:auto; -webkit-overflow-scrolling:touch;">
      <h3 id="modalTitle" style="margin-top:0;">Tambah Forklift</h3>
      <div id="form"></div>
      <div style="text-align:right; margin-top:10px;">
        <button id="cancelBtn">Batal</button>
        <button id="saveBtn">Simpan</button>
      </div>
    </div>
  </div>

  <script>
  window.addEventListener('DOMContentLoaded', ()=>{ (async function(){
    const user = await ensureAuthedAndRenderNav(); if (!user) return;
    let data = await api('/api/forklifts');
    let selected = new Set();

    const columns = [
      { key:'__sel', label:'Sel' },
      { key:'brand', label:'Brand' },
      { key:'type', label:'Type' },
      { key:'eq_no', label:'EQ No' },
      { key:'serial', label:'Serial' },
      { key:'location', label:'Location' },
      { key:'powertrain', label:'Powertrain' },
      { key:'owner', label:'Owner' },
      { key:'tahun', label:'Tahun' },
      { key:'status', label:'Status' },
      { key:'__act', label:'Aksi' },
    ];

    let page = 1; let rows = 10;
   let currentRows = [];
// State sorting header
let sortKey = null;
let sortDir = 'asc';
function sortRows(rows){
  const arr = (rows||[]).slice();
  if (!sortKey) return arr;
  const cmp = (a,b)=>{
    const va = a[sortKey]; const vb = b[sortKey];
    // Khusus Powertrain: urutan custom
    if (sortKey==='powertrain'){
      const normalize = s=>String(s||'').toLowerCase();
      const orderAsc = ['electric','lpg','diesel','manual','instruments & tools'];
      const orderDesc = ['lpg','electric','diesel','manual','instruments & tools'];
      const order = sortDir==='asc' ? orderAsc : orderDesc;
      const ia = order.indexOf(normalize(va)); const ib = order.indexOf(normalize(vb));
      if (ia !== ib) return ia - ib;
      return normalize(va).localeCompare(normalize(vb), undefined, { sensitivity:'base' });
    }
    // Numeric vs string general compare
    const na = parseFloat(va); const nb = parseFloat(vb);
    if (!Number.isNaN(na) && !Number.isNaN(nb)) return sortDir==='asc' ? na - nb : nb - na;
    const sa = String(va||'').toLowerCase(); const sb = String(vb||'').toLowerCase();
    const d = sa.localeCompare(sb, undefined, { sensitivity:'base', numeric:true });
    return sortDir==='asc' ? d : -d;
  };
  arr.sort(cmp);
  return arr;
}

    // helper untuk kapitalisasi status saat ditampilkan
    function ucFirst(s){
      s = String(s||'');
      return s ? s.charAt(0).toUpperCase() + s.slice(1).toLowerCase() : s;
    }

    function formHtml(item={}){
      const powertrainList = ['Electric','Diesel','LPG','Manual','Instruments & Tools'];
      const statusList = ['Active','Retired','Maintenance'];
      let ptSelected = null;
      if (item.powertrain){
        const found = powertrainList.find(v=>String(v).toLowerCase()===String(item.powertrain).toLowerCase());
        ptSelected = found || null;
      }
      let stSelected = null;
      if (item.status){
        const foundSt = statusList.find(v=>String(v).toLowerCase()===String(item.status).toLowerCase());
        stSelected = foundSt || null;
      }
      // Build opsi powertrain (tambahkan opsi lama bila tidak ada di list)
      const ptOptions = [ptSelected?null:(item.powertrain?{v:item.powertrain, t:item.powertrain}:null), ...powertrainList.map(v=>({v,t:v}))]
        .filter(Boolean)
        .map(o=>`<option value="${o.v}" ${ptSelected? (String(o.v).toLowerCase()===String(ptSelected).toLowerCase()? 'selected':'') : (item.powertrain && String(o.v).toLowerCase()===String(item.powertrain).toLowerCase() ? 'selected':'' )}>${o.t}</option>`)
        .join('');
      // Build opsi status (tambahkan opsi lama bila tidak ada di list)
      const stOptions = [stSelected?null:(item.status?{v:item.status, t:item.status}:null), ...statusList.map(v=>({v,t:v}))]
        .filter(Boolean)
        .map(o=>`<option value="${o.v}" ${stSelected? (String(o.v).toLowerCase()===String(stSelected).toLowerCase()? 'selected':'') : (item.status && String(o.v).toLowerCase()===String(item.status).toLowerCase() ? 'selected':'' )}>${o.t}</option>`)
        .join('');
      const ownerVal = item.owner && String(item.owner).toLowerCase()==='customer own' ? 'Customer Own' : 'PS Own';

      return `
        <div style='margin-bottom:8px;'><div style='font-size:12px; color:#666;'>BRAND</div><input id='f_brand' value='${item.brand??''}' /></div>
        <div style='margin-bottom:8px;'><div style='font-size:12px; color:#666;'>TYPE</div><input id='f_type' value='${item.type??''}' /></div>
        <div style='margin-bottom:8px;'><div style='font-size:12px; color:#666;'>EQ NO</div><input id='f_eq_no' value='${item.eq_no??''}' /></div>
        <div style='margin-bottom:8px;'><div style='font-size:12px; color:#666;'>SERIAL</div><input id='f_serial' value='${item.serial??''}' /></div>
        <div style='margin-bottom:8px;'><div style='font-size:12px; color:#666;'>LOCATION</div><input id='f_location' value='${item.location??''}' /></div>
        <div style='margin-bottom:8px;'><div style='font-size:12px; color:#666;'>POWERTRAIN</div>
          <select id='f_powertrain'>${ptOptions}</select>
        </div>
        <div style='margin-bottom:8px;'><div style='font-size:12px; color:#666;'>OWNER</div>
          <label style='margin-right:12px;'><input type='radio' name='f_owner_group' value='PS Own' ${ownerVal==='PS Own'?'checked':''}/> PS Own</label>
          <label><input type='radio' name='f_owner_group' value='Customer Own' ${ownerVal==='Customer Own'?'checked':''}/> Customer Own</label>
        </div>
        <div style='margin-bottom:8px;'><div style='font-size:12px; color:#666;'>TAHUN</div><input id='f_tahun' type='number' value='${item.tahun??''}' /></div>
        <div style='margin-bottom:8px;'><div style='font-size:12px; color:#666;'>STATUS</div>
          <select id='f_status'>${stOptions}</select>
        </div>
      `;
    }

    function render(){
      perfStart && perfStart('forklift.render');
      const q = document.getElementById('search').value;
      const filtered = filterData(data, q);
      const sorted = sortRows(filtered);
      const start = (page-1)*rows; const end = start+rows;
      const rowsData = sorted.slice(start,end).map(x=>Object.assign({}, x));
      currentRows = rowsData;
      const header = '<thead><tr>' + columns.map(c=>{
        if (c.key==='__sel') return `<th class="sel-header" style="cursor:pointer" title="Pilih semua di halaman">Sel</th>`;
        if (c.key==='__act') return `<th>Aksi</th>`;
        const arrow = sortKey===c.key ? (sortDir==='asc'?' ▲':' ▼') : '';
        return `<th data-key="${c.key}" style="cursor:pointer">${c.label}${arrow}</th>`;
      }).join('') + '</tr></thead>';
      const body = '<tbody>' + rowsData.map(row=>{
        const cb = `<input type='checkbox' data-id='${row.id}' ${selected.has(row.id)?'checked':''}/>`;
        const actions = (user.role==='admin'||user.role==='supervisor') ? `<button data-edit='${row.id}'>Edit</button> <button data-del='${row.id}'>Hapus</button>` : '';
        return `<tr>
          <td>${cb}</td>
          <td>${row.brand||''}</td>
          <td>${row.type||''}</td>
          <td>${row.eq_no||''}</td>
          <td>${row.serial||''}</td>
          <td>${row.location||''}</td>
          <td>${row.powertrain||''}</td>
          <td>${row.owner||''}</td>
          <td>${row.tahun||''}</td>
          <td>${ucFirst(row.status)||''}</td>
          <td>${actions}</td>
        </tr>`;
      }).join('') + '</tbody>';
      document.getElementById('table').innerHTML = `<table>${header}${body}</table>`;
      applyTablePerformanceHints('table');
      perfEnd && perfEnd('forklift.render', `q="${q}" n=${data?.length||0} filtered=${filtered.length} pageRows=${rowsData.length}`);
      
      // Select-all per halaman saat klik header "Sel"
      const selHeader = document.querySelector('th.sel-header');
      if (selHeader) selHeader.onclick = ()=>{
        const allSelected = currentRows.length>0 && currentRows.every(r=> selected.has(r.id));
        if (allSelected) { currentRows.forEach(r=> selected.delete(r.id)); } else { currentRows.forEach(r=> selected.add(r.id)); }
        render();
      };

      // Event delegation pada container tabel: checkbox & tombol aksi
      const tableContainer = document.getElementById('table');
      if (tableContainer){
        // Delegasi perubahan checkbox per-baris (select)
        if (!tableContainer.dataset.cbDelegated){
          tableContainer.addEventListener('change', (ev)=>{
            const cb = ev.target.closest("input[type='checkbox'][data-id]");
            if (!cb) return;
            const id = +cb.getAttribute('data-id');
            if (cb.checked) selected.add(id); else selected.delete(id);
          });
          tableContainer.dataset.cbDelegated = '1';
        }
        // Delegasi klik tombol Edit/Hapus
        if (!tableContainer.dataset.clickDelegated){
          tableContainer.addEventListener('click', async (ev)=>{
            const btn = ev.target.closest('button');
            if (!btn) return;
            if (btn.hasAttribute('data-edit')){
              const id = btn.getAttribute('data-edit');
              const item = data.find(x=> String(x.id)===String(id));
              if (item) openModal('Edit Forklift', item);
              return;
            }
            if (btn.hasAttribute('data-del')){
              if (!(await confirmDialog('Hapus data forklift ini?'))) return;
              try{
                btn.disabled = true;
                const id = btn.getAttribute('data-del');
                await api('/api/forklifts/'+id, { method:'DELETE' });
                data = await api('/api/forklifts');
                render();
              }catch(e){
                console.error('Delete forklift error:', e);
                alert((e && e.error) ? e.error : 'Gagal menghapus data');
              }finally{
                btn.disabled = false;
              }
              return;
            }
          });
          tableContainer.dataset.clickDelegated = '1';
        }
      }
      // Header sort handlers
      document.querySelectorAll('#table th[data-key]').forEach(th=>{
        th.onclick = ()=>{
          const key = th.getAttribute('data-key');
          if (key==='__sel' || key==='__act') return;
          if (sortKey===key){ sortDir = (sortDir==='asc'?'desc':'asc'); } else { sortKey = key; sortDir = 'asc'; }
          page = 1;
          render();
        };
      });
      const pages = Math.max(1, Math.ceil(filtered.length/rows));
      document.getElementById('pagination').innerHTML = Array.from({length: pages}, (_,i)=>`<button data-p='${i+1}' ${i+1===page?'style="font-weight:700"':''}>${i+1}</button>`).join(' ');
      document.querySelectorAll('#pagination button').forEach(b=>b.onclick = ()=>{ page = parseInt(b.getAttribute('data-p')); render();});
    }

    document.getElementById('search').oninput = debounce(render, 200);
    document.getElementById('rowsPerPage').onchange = (e)=>{ rows = parseInt(e.target.value); page=1; render(); };
    document.getElementById('addBtn').onclick = ()=> openModal('Tambah Forklift', {});
    document.getElementById('bulkDeleteBtn').onclick = async ()=>{
      if (!(user.role==='admin'||user.role==='supervisor')) return alert('Tidak punya akses');
      if (selected.size===0) return alert('Tidak ada yang dipilih');
      if (!(await confirmDialog('Hapus data yang terpilih ?'))) return;
      try {
        const ids = Array.from(selected);
        await api('/api/forklifts/bulk-delete', { method:'POST', body: { ids } });
        selected.clear();
        data = await api('/api/forklifts');
        render();
        alert('Bulk delete sukses');
      } catch (e) {
        console.error('Bulk delete forklifts error:', e);
        const msg = (e && e.error) ? e.error : 'Gagal menghapus data';
        alert(msg);
      }
    };

    // Export helpers & handlers
    function downloadBlob(filename, blob){
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url; link.download = filename;
      document.body.appendChild(link); link.click();
      setTimeout(()=>{ URL.revokeObjectURL(url); document.body.removeChild(link); }, 0);
    }

    document.getElementById('exportExcel').onclick = async ()=>{
      try {
        await window.ensureExcelJS();
        if (!window.ExcelJS) { alert('Library ExcelJS tidak tersedia.'); return; }
        const exportCols = columns.filter(c=> c.key !== '__sel' && c.key !== '__act');

        const q = document.getElementById('search')?.value || '';
        const filteredAll = (typeof filterData==='function') ? (filterData(data, q) || []) : (data || []);
        const useSelected = selected && selected.size>0;
        const idSet = useSelected ? new Set(Array.from(selected)) : null;
        const rowsSource = useSelected ? filteredAll.filter(r=> idSet.has(r.id)) : filteredAll;
        const rowsArr = rowsSource.map(row => exportCols.map(c => String(row[c.key] ?? '')));
        const wb = new ExcelJS.Workbook();
        const ws = wb.addWorksheet('Forklifts');
        // Uniform widths and alignment (wrap long text columns)
        const widthsMap = {
          brand: 24, type: 24, eq_no: 18, serial: 18, location: 24, powertrain: 18, owner: 18, tahun: 12, status: 14
        };
        ws.columns = exportCols.map((c,i)=>{
          const w = widthsMap[c.key] ?? 18;
          return { header: c.label, key: c.key, width: w, style: { alignment: { vertical:'top', wrapText: ['brand','type','location'].includes(c.key) } } };
        });
        ws.addRows(rowsArr);
        // Header style, freeze, filter, borders, zebra
        const headerRow = ws.getRow(1);
        try{
          headerRow.font = { bold: true, color: { argb: 'FFFFFFFF' } };
          headerRow.alignment = { vertical: 'middle', horizontal: 'center', wrapText: true };
          headerRow.height = 22;
          headerRow.eachCell(cell=> cell.fill = { type:'pattern', pattern:'solid', fgColor:{ argb:'FF0D47A1' } });
          ws.views = [{ state:'frozen', xSplit:0, ySplit:1 }];
          ws.autoFilter = { from: { row:1, column:1 }, to: { row:1, column: exportCols.length } };
        }catch{}
        try{
          const lastRow = ws.rowCount;
          // Zebra striping
          for (let r = 2; r <= lastRow; r++){
            if (r % 2 === 0){ ws.getRow(r).eachCell(cell=> cell.fill = { type:'pattern', pattern:'solid', fgColor:{ argb:'FFF2F6FC' } }); }
          }
          // Thin borders
          for (let r = 1; r <= lastRow; r++){
            const row = ws.getRow(r);
            for (let c = 1; c <= exportCols.length; c++){
              const cell = row.getCell(c);
              cell.border = {
                top: { style:'thin', color:{ argb:'FFB0BEC5' } },
                left: { style:'thin', color:{ argb:'FFB0BEC5' } },
                bottom: { style:'thin', color:{ argb:'FFB0BEC5' } },
                right: { style:'thin', color:{ argb:'FFB0BEC5' } },
              };
            }
          }
        }catch{}
        const buffer = await wb.xlsx.writeBuffer();
        const blob = new Blob([buffer], { type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' });
        downloadBlob('forklifts.xlsx', blob);
      } catch(e){
        console.error('Export Excel error:', e);
        alert('Gagal mengekspor Excel.');
      }
    };

    // Import Excel -> baca file XLSX (format sama dengan export), kirim ke server untuk di-insert/update
    document.getElementById('importExcel').onclick = async ()=>{
      if (user.role==='teknisi') { alert('Tidak punya akses untuk import.'); return; }
      try {
        await window.ensureExcelJS();
        if (!window.ExcelJS) { alert('Library ExcelJS tidak tersedia.'); return; }
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = '.xlsx';
        input.onchange = async (e)=>{
          const file = e.target.files && e.target.files[0];
          if (!file) return;
          const ab = await file.arrayBuffer();
          const wb = new ExcelJS.Workbook();
          await wb.xlsx.load(ab);
          const ws = wb.worksheets[0];
          if (!ws){ alert('Worksheet tidak ditemukan.'); return; }

          // Validasi header (A..I)
          const expected = ['Brand','Type','EQ No','Serial','Location','Powertrain','Owner','Tahun','Status'];
          const header = expected.map((_,i)=> String(ws.getRow(1).getCell(i+1).value||'').trim());
          const okHeader = expected.every((h,i)=> (header[i]||'').toLowerCase() === h.toLowerCase());
          if (!okHeader){
            alert('Format header tidak sesuai. Pastikan sama seperti hasil Export: '+expected.join(', '));
            return;
          }

          const rows = [];
          for (let r = 2; r <= ws.rowCount; r++){
            const row = ws.getRow(r);
            const brand = String(row.getCell(1).value ?? '').trim();
            const type = String(row.getCell(2).value ?? '').trim();
            const eq_no = String(row.getCell(3).value ?? '').trim();
            const serial = String(row.getCell(4).value ?? '').trim();
            const location = String(row.getCell(5).value ?? '').trim();
            const powertrain = String(row.getCell(6).value ?? '').trim();
            const owner = String(row.getCell(7).value ?? '').trim();
            const tahunRaw = row.getCell(8).value;
            const tahun = (tahunRaw===null||tahunRaw===undefined||String(tahunRaw).trim()==='') ? null : parseInt(String(tahunRaw).replace(/\D+/g,'')) || null;
            const status = String(row.getCell(9).value ?? '').trim();

            // Skip baris kosong total
            if (![brand,type,eq_no,serial,location,powertrain,owner,tahun,status].some(v=> (v!=='' && v!==null && v!==undefined))) continue;

            rows.push({ brand, type, eq_no, serial, location, powertrain, owner, tahun, status });
          }
          if (rows.length===0){ alert('Tidak ada data untuk diimport.'); return; }

          const resp = await api('/api/forklifts/import', { method:'POST', body:{ rows } });
          alert(`Import selesai. Inserted: ${resp.inserted||0}, Updated: ${resp.updated||0}${resp.errors && resp.errors.length? `, Errors: ${resp.errors.length}`:''}`);
          data = await api('/api/forklifts');
          render();
        };
        input.click();
      } catch (e){
        console.error('Import error:', e);
        alert('Gagal import Excel.');
      }
    };
    document.getElementById('exportPDF').onclick = async ()=>{
      try {
        await window.ensureJsPDF();
        if (window.jspdf && window.jspdf.jsPDF){
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF({ orientation: 'landscape', unit: 'pt', format: 'A4' });
          const exportCols = columns.filter(c=> c.key !== '__sel' && c.key !== '__act');
          const head = [exportCols.map(c => c.label)];

          const q = document.getElementById('search')?.value || '';
          const filteredAll = (typeof filterData==='function') ? (filterData(data, q) || []) : (data || []);
          const useSelected = selected && selected.size>0;
          const idSet = useSelected ? new Set(Array.from(selected)) : null;
          const rowsSource = useSelected ? filteredAll.filter(r=> idSet.has(r.id)) : filteredAll;
          const body = rowsSource.map(row => exportCols.map(c => String(row[c.key] ?? '')));
          if (doc.autoTable) {
            doc.autoTable({
              head, body,
              styles: { fontSize: 8, cellPadding: 3 },
              headStyles: { fillColor: [13,71,161], textColor: 255 },
              margin: { top: 20, left: 15, right: 15 },
            });
          }
          doc.save('forklifts.pdf');
        } else {
          window.print();
        }
      } catch(e){
        console.error('Export PDF error:', e);
        alert('Gagal mengekspor PDF.');
      }
    };

    function openModal(title, item){
      if (!(user.role==='admin'||user.role==='supervisor')) return alert('Tidak punya akses');
      document.getElementById('modalTitle').textContent = title;
      document.getElementById('form').innerHTML = formHtml(item);
      document.getElementById('modal').style.display = 'flex';
      document.getElementById('cancelBtn').onclick = ()=> { modal.style.display = 'none'; };
      // click-away: tutup saat klik backdrop saja (bukan konten)
      modal.onclick = (ev)=>{ if (ev.target === modal) modal.style.display = 'none'; };
      document.getElementById('saveBtn').onclick = async ()=>{
        try {
          const ownerChecked = document.querySelector("input[name='f_owner_group']:checked");
          const payload = {
            brand: document.getElementById('f_brand').value,
            type: document.getElementById('f_type').value,
            eq_no: document.getElementById('f_eq_no').value,
            serial: document.getElementById('f_serial').value,
            location: document.getElementById('f_location').value,
            powertrain: document.getElementById('f_powertrain').value,
            owner: ownerChecked ? ownerChecked.value : '',
            tahun: parseInt(document.getElementById('f_tahun').value||0),
            status: String(document.getElementById('f_status').value||'').toLowerCase(),
          };
          if (item.id) {
            await api('/api/forklifts/'+item.id, { method:'PUT', body: payload });
            alert('Data forklift berhasil diperbarui');
          } else {
            await api('/api/forklifts', { method:'POST', body: payload });
            alert('Forklift baru berhasil ditambahkan');
          }
          modal.style.display='none';
          data = await api('/api/forklifts'); render();
        } catch (e) {
          console.error('Forklift save error:', e);
          const msg = (e && e.error) ? e.error : 'Gagal menyimpan forklift';
          alert(msg);
        }
      };
    }

    // Hapus event listener yang memanggil load() karena fungsi load tidak ada di forklift.html
    // (tidak ada perubahan lain)
    render();
   })(); });
  </script>
</body>
</html>